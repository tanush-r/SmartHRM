<div class="container candidate-master-container">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h4 class="text-center flex-grow-1">Candidate Master</h4>
    <button mat-raised-button color="primary" (click)="openCandidateForm()" [disabled]="!clientsLoaded">
      <mat-icon>add</mat-icon> Add Candidate
    </button>
  </div>

  <div class="d-flex align-items-center mt-3"> 
    <div class="flex-grow-1 me-2">
      <mat-form-field appearance="fill" class="w-100">
        <mat-label>Client Name</mat-label>
        <mat-select [(ngModel)]="selectedClientId" (selectionChange)="onClientChange()">
          <mat-option value="" disabled>Select a client</mat-option>
          <mat-option *ngFor="let client of clients" [value]="client.cl_id">{{ client.cl_name }}</mat-option>
        </mat-select>
      </mat-form-field>
    </div>
  
    <div class="flex-grow-1 me-2">
      <mat-form-field appearance="fill" class="w-100">
        <mat-label>Requirement Name</mat-label>
        <mat-select [(ngModel)]="selectedRequirementId" (selectionChange)="onRequirementChange()">
          <mat-option value="" disabled>Select a requirement</mat-option>
          <mat-option *ngFor="let requirement of requirements" [value]="requirement.rq_id">{{ requirement.rq_name }}</mat-option>
        </mat-select>
      </mat-form-field>
    </div>    
    
    <div class="flex-grow-2">
      <mat-form-field appearance="fill" class="w-100">
        <mat-label>Search here...</mat-label>
        <mat-icon matPrefix>search</mat-icon>
        <input matInput [(ngModel)]="searchQuery" (ngModelChange)="filterCandidates()" />
        <button mat-icon-button *ngIf="searchQuery" (click)="searchQuery = ''; filterCandidates();">
          <mat-icon>close</mat-icon>
        </button>
      </mat-form-field>
    </div>
  </div>

  <br>

  <div class="table-responsive">
    <table mat-table [dataSource]="filteredCandidates" class="mat-elevation-z8 full-width-table">
      <ng-container matColumnDef="name">
        <th mat-header-cell *matHeaderCellDef class="table-header">Name</th>
        <td mat-cell *matCellDef="let candidate">{{ candidate?.cd_first_name }} {{ candidate?.cd_last_name }}</td>
      </ng-container>

      <ng-container matColumnDef="date">
        <th mat-header-cell *matHeaderCellDef class="table-header">Date</th>
        <td mat-cell *matCellDef="let candidate">{{ candidate?.created_at ? (candidate.created_at | date:'shortDate') : 'N/A' }}</td>
      </ng-container>

      <ng-container matColumnDef="email">
        <th mat-header-cell *matHeaderCellDef class="table-header">Email</th>
        <td mat-cell *matCellDef="let candidate">{{ candidate?.cd_email }}</td>
      </ng-container>

      <ng-container matColumnDef="phoneNumber">
        <th mat-header-cell *matHeaderCellDef class="table-header">Phone Number</th>
        <td mat-cell *matCellDef="let candidate">{{ candidate?.cd_phno }}</td>
      </ng-container>

      <ng-container matColumnDef="location">
        <th mat-header-cell *matHeaderCellDef class="table-header">Location</th>
        <td mat-cell *matCellDef="let candidate">{{ candidate?.cd_loc }}</td>
      </ng-container>

      <ng-container matColumnDef="experience">
        <th mat-header-cell *matHeaderCellDef class="table-header">Experience</th>
        <td mat-cell *matCellDef="let candidate">{{ candidate?.cd_total_exp }} years</td>
      </ng-container>

      <ng-container matColumnDef="action">
        <th mat-header-cell *matHeaderCellDef class="table-header">Action</th>
        <td mat-cell *matCellDef="let candidate">
          <button mat-icon-button color="info" (click)="viewCandidate(candidate)">
            <mat-icon>visibility</mat-icon>
          </button>
          <button mat-icon-button color="accent" (click)="editCandidate(candidate)">
            <mat-icon>edit</mat-icon>
          </button>
          <button mat-icon-button color="warn" (click)="deleteCandidate(candidate)">
            <mat-icon>delete</mat-icon>
          </button>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="['name', 'date', 'email', 'phoneNumber', 'location', 'experience', 'action']"></tr>
      <tr mat-row *matRowDef="let row; columns: ['name', 'date', 'email', 'phoneNumber', 'location', 'experience', 'action'];"></tr>
    </table>
    
    <div *ngIf="filteredCandidates.length === 0" class="text-center mt-3">
      <p>No candidates available.</p>
    </div>
  </div>
</div>
